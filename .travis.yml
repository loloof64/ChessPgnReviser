language: cpp
compiler: gcc
sudo: require
dist: trusty
before_install:
- sudo add-apt-repository ppa:beineri/opt-qt-5.10.1-trusty -y
- sudo apt-get update
- mkdir -p appdir/usr/bin
- mkdir -p appdir/usr/translations
install:
- sudo apt-get -y install qt510base qt510svg qt510translations qt510tools libgl1-mesa-dev libgtk2.0-dev git
- source /opt/qt*/bin/qt*-env.sh
script:
- lupdate ChessPgnReviser.pro
- lrelease ChessPgnReviser.pro
- qmake CONFIG+=release PREFIX=/usr
- make -j$(nproc)
- make INSTALL_ROOT=appdir -j$(nproc) install ; find appdir/
- cp appdir/opt/ChessPgnReviser/bin/ChessPgnReviser appdir/usr/bin
- cp /home/travis/build/loloof64/ChessPgnReviser/resources/translations/*.qm appdir/usr/translations
- git clone http://code.qt.io/qt/qtstyleplugins.git
- cd qtstyleplugins
- qmake
- make -j$(nproc)
- sudo make install
- cd -
- wget -c -nv "https://github.com/probonopd/linuxdeployqt/releases/download/continuous/linuxdeployqt-continuous-x86_64.AppImage"
- chmod a+x linuxdeployqt-continuous-x86_64.AppImage
- "./linuxdeployqt-continuous-x86_64.AppImage appdir/usr/share/applications/*.desktop
  -bundle-non-qt-libs -verbose=1"
- "./linuxdeployqt-continuous-x86_64.AppImage appdir/usr/share/applications/*.desktop
  -appimage -verbose=1"
after_success:
- mv Chess_Pgn_Reviser*.AppImage ChessPgnReviser-Linux-x86_64.AppImage
- chmod a+x ChessPgnReviser-Linux-x86_64.AppImage
- wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh
- bash upload.sh ChessPgnReviser-Linux-x86_64.AppImage

deploy:
  provider: releases
  api_key:
    secure: "qS1+w78jWyR/B6xB93g84XaBgDk6sKw16g6osgZqKu8DRx3KTB4F5FvGFVU/tmRtBy67r1oMJ8FtnQp3Ve9qzdRO2wWteSRshCd8WRDTpHa2BRofyt48p82tgSQarxxZTYBYRLbVeiS0THrQuj3LTMFuFcsoVOmGbf0q3EbJ1J7Fg42VS72nxlPTaOIFgBitBuZPjDtS2Y0wDxq5Perlzb1gYH0WqeH+/6B8K+zDzs/JRCHK0iwsTUbvchbv9vlBUnUO4OpCgalh6N2ASuzprsIWMO2o4SGicZ4OpMpZFJ7tOnMg3SpylI/EXb1zut9LtfMb96SfnAfvzfo0dbb2BJN9cRyT3ZJKx1Doy0ggWkNGBkbPBKpldE0YxEW3uCj1e16PqOItAAuO4Uezv8e95eHfOhTaoe7X6P6fXXV71xUQgxrHvwqYTFQoUSXxg0GVX/X9y4fJhZiiMsHCobHXaG9S1N/Qv0QwaSj3RRi2zedDFV3/sIy90FOjJdyEB6Qymnkl7YM8YIu/LcW1KVjqmczXmp+4tYCd38M/m192H+4rab/jtqQyZhWaM+2NU2THNQO1sCQaIP72kdDIHQ9HmF/bEo2yEKHRqmgFKEJaNNWDaWgKzzCks+tRp+bx37lj2So7bXtB2e2ow5a6v1sUDPfGXTIN2s2BD3KypXgu34I="
  file: ChessPgnReviser-Linux-x86_64.AppImage
  on:
    tags: true
  skip_cleanup: 'true'
